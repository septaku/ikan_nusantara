<!DOCTYPE html>
<html>
  <head>
    <title>Ongkos Kirim</title>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBeLKmlSgPHmdqCLP_kpCGqcEQCEncBue4"></script>
    <script>
      var sellerLocation = {lat: -6.243774976377524, lng: 106.99290284573747};
      
      function initMap() {
        var map = new google.maps.Map(document.getElementById('map'), {
          zoom: 10,
          center: sellerLocation
        });
        var sellerMarker = new google.maps.Marker({
          position: sellerLocation,
          map: map,
          title: 'Penjual'
        });
        
        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(function(position) {
            var buyerLocation = {lat: position.coords.latitude, lng: position.coords.longitude};
            var buyerMarker = new google.maps.Marker({
              position: buyerLocation,
              map: map,
              title: 'Pembeli'
            });
            
            var distanceKm = haversineDistance(sellerLocation.lat, sellerLocation.lng, buyerLocation.lat, buyerLocation.lng);
            var shippingCost = calculateShippingCost(distanceKm);
            
            var link = document.getElementById('whatsapp-link');
            link.href = 'https://wa.me/6281234567890?text=' +
                        encodeURIComponent('Nama: \nLokasi: ' + 
                                           'https://www.google.com/maps?q=' + 
                                           buyerLocation.lat + ',' + buyerLocation.lng + '\n' +
                                           'Jumlah Pemesanan: ');
            
            var info = document.getElementById('info');
            info.innerHTML = 'Jarak antara penjual dan pembeli: ' + distanceKm.toFixed(2) + ' km<br>' +
                             'Ongkos kirim: Rp ' + shippingCost.toLocaleString();
          });
        }
      }
      
      function toRadians(degrees) {
        return degrees * Math.PI / 180;
      }

      function haversineDistance(lat1, lon1, lat2, lon2) {
        var earthRadiusKm = 6371;

        var dLat = toRadians(lat2 - lat1);
        var dLon = toRadians(lon2 - lon1);

        lat1 = toRadians(lat1);
        lat2 = toRadians(lat2);

        var a = Math.sin(dLat / 2) * Math.sin(dLat / 2) +
                Math.sin(dLon / 2) * Math.sin(dLon / 2) * Math.cos(lat1) * Math.cos(lat2);
        var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
        return earthRadiusKm * c;
      }
      
      function calculateShippingCost(distanceKm) {
        var ratePerKm = 1000;
        return distanceKm * ratePerKm;
      }
    </script>
  </head>
  <body onload="initMap()">
    <h1>Ongkos Kirim</h1>
    <div id="map" style="width:100%;height:500px;"></div>
    <div id="info"></div>
    <a id="whatsapp-link" href="#">Klik untuk Order via Whatsapp</a>
  </body>
</html>
